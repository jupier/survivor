#!/usr/bin/env sh
. "$(dirname "$0")/_/husky.sh"

# Check if there are any commits to push
if [ -z "$(git rev-list @{u}..HEAD 2>/dev/null)" ]; then
  echo "No commits to push, skipping version bump"
  exit 0
fi

# Check if version was already bumped in this commit
if git diff --cached --name-only | grep -q "package.json"; then
  echo "Version already updated in staged changes, skipping auto-bump"
  exit 0
fi

# Bump version automatically
echo "Bumping version before push..."
node scripts/bump-version.js

# Stage and commit the updated package.json
git add package.json
git commit -m "Bump version (auto-bumped by pre-push hook)" --no-verify

# The version.ts file will be regenerated by the vite plugin on next build
echo "âœ“ Version bumped and committed. Ready to push!"

